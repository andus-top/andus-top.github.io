<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="keywords" content="个人博客, 松林羊, ysl, songlinsheep, andus, blog, 个人站点, 个人网站"><meta name="description" content="松林羊的个人网站，用于记录，分享。欢迎交流^-^"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title> JAVA多线程-Object.wait()，Object.notify()，Object.notifyAll() | 松林羊</title><link rel="shortcut icon" href="/smile.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css"><script src="/js/pace.min.js"></script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"1559132c"}),daovoice("update")</script></head></html><body><main class="content"><section class="outer"><article id="post-JAVA多线程-Object-wait-，Object-notify-，Object-notifyAll" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name"> JAVA多线程-Object.wait()，Object.notify()，Object.notifyAll()</h1></header><div class="article-meta"> <a href="/2019/11/18/JAVA多线程-Object-wait-，Object-notify-，Object-notifyAll/" class="article-date"><time datetime="2019-11-18T13:05:24.000Z" itemprop="datePublished">2019-11-18</time></a><div class="article-category"> <a class="article-category-link" href="/categories/编程语言/">编程语言</a></div> &emsp;<i class="fe fe-bar-chart"></i> <span class="post-count">1.3k</span>字 &emsp;<i class="fe fe-clock"></i> <span class="post-count">5</span>分钟</div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><h1 id="初步理解"><a href="#初步理解" class="headerlink" title="初步理解"></a>初步理解</h1><p><b>wait()</b></p><ol><li>使线程停止运行，进入等待队列，<font color="pink">会立刻释放对象锁</font>。</li><li>wait(0) 代表的是<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait-long-" target="_blank" rel="noopener">无限期的等待</a>，不能自动唤醒。</li><li>java.lang.Object类方法。</li></ol><p><b>notify()</b></p><ol><li>唤醒一个<font color="pink">正在等待当前对象</font>的waiting线程，遵循FIFO（先进先出）策略。</li><li>notify()调用后，并<font color="pink">不是马上就释放对象锁</font>，而是在相应的<font color="pink">synchronized{…}语句块执行结束</font>后，自动释放锁后，JVM在wait()对象锁的线程中随机选取一线程赋予其对象锁，唤醒线程，继续执行。<font color="red">这样就提供了在线间同步、唤醒的操作</font>。</li><li>java.lang.Object类方法。</li></ol><p><b>notifyAll()</b></p><ol><li>唤醒正在等待当前对象的所有等待线程。</li><li>默认的唤醒策略是：LIFO（后进先出）。</li><li>java.lang.Object类方法。</li></ol><p><b>wait()与notify()</b></p><ol><li>Obj.wait()，与Obj.notify()必须与synchronized(Obj)一起使用，也就是wait()是针对已经获取了Obj锁进行操作。</li><li>从<b>语法角度</b>来说就是Obj.wait()，Obj.notify()必须在、synchronized(Obj){…}语句块内。</li><li>从<b>功能上</b>来说wait就是指在该线程获取对象锁后，主动释放对象锁，同时本线程休眠。notify()就是对对象锁的唤醒操作。</li></ol><p><b>wait()与sleep()</b><br>共同点</p><ol><li>都可以指定线程阻塞的时间。</li><li>都可以通过interrupt()方法打断(不建议使用)线程的暂停状态 ，从而使线程立刻抛出InterruptedException。如果线程A希望立即结束线程B，则可以对线程B对应的Thread实例调用interrupt方法。如果此刻线程B正在wait/sleep /join，则线程B会立刻抛出InterruptedException，在catch() {} 中直接return即可安全地结束线程。<br><u>需要注意的是</u>，InterruptedException是线程自己从内部抛出的，并不是interrupt()方法抛出的。对某一线程调用 interrupt()时，如果该线程正在执行普通的代码，那么该线程根本就不会抛出InterruptedException。但是，一旦该线程进入到 wait()/sleep()/join()后，就会立刻抛出InterruptedException 。</li></ol><p>不同点</p><ol><li>sleep()是Thread类的方法，wait()是Object类的方法。</li><li>sleep()方法没有释放锁，而wait()方法释放了锁。</li><li>wait，notify和notifyAll只能在同步控制方法或者同步控制块里面使用，而sleep可以在任何地方使用。</li></ol><h1 id="执行notify-后，waiting线程可能的状态"><a href="#执行notify-后，waiting线程可能的状态" class="headerlink" title="执行notify()后，waiting线程可能的状态"></a>执行notify()后，waiting线程可能的状态</h1><p>线程a先抢到了对象o的锁，然后wait，然后b抢到了o的锁，然后b中调用o.notify并释放锁，此时a是running状态还是blocked状态？？<br>如果b在执行完notify()后没有释放锁则线程a是阻塞等待，<br>如果线程b执行完同步代码块（释放锁）后，则线程a就是就绪态，不一定是运行态</p><h1 id="代码实操，三线程打印ABC"><a href="#代码实操，三线程打印ABC" class="headerlink" title="代码实操，三线程打印ABC"></a>代码实操，三线程打印ABC</h1><p> 建立三个线程，A线程打印10次A，B线程打印10次B,C线程打印10次C，要求线程同时运行，交替打印10次ABC。这个问题用Object的wait()，notify()就可以很方便的解决。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T08WaitNotify</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">T</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="comment">// 自定义线程名称</span></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="comment">// 前一个obj</span></span><br><span class="line">        <span class="keyword">private</span> Object prev;</span><br><span class="line">        <span class="comment">// 当前obj</span></span><br><span class="line">        <span class="keyword">private</span> Object self;</span><br><span class="line"></span><br><span class="line">        T(String name, Object prev, Object self)&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">this</span>.prev = prev;</span><br><span class="line">            <span class="keyword">this</span>.self = self;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (count &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (prev) &#123;</span><br><span class="line">                    <span class="keyword">synchronized</span> (self) &#123;</span><br><span class="line">                        System.out.print(name);</span><br><span class="line">                        count++;</span><br><span class="line">                        self.notify();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        prev.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        T08WaitNotify obj = <span class="keyword">new</span> T08WaitNotify();</span><br><span class="line"></span><br><span class="line">        Object oa = <span class="keyword">new</span> Object();</span><br><span class="line">        Object ob = <span class="keyword">new</span> Object();</span><br><span class="line">        Object oc = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">        T a = obj.new T(<span class="string">"A"</span>, oc, oa);</span><br><span class="line">        T b = obj.new T(<span class="string">"B"</span>, oa, ob);</span><br><span class="line">        T c = obj.new T(<span class="string">"C"</span>, ob, oc);</span><br><span class="line"></span><br><span class="line">        Thread ta = <span class="keyword">new</span> Thread(a);</span><br><span class="line">        Thread tb = <span class="keyword">new</span> Thread(b);</span><br><span class="line">        Thread tc = <span class="keyword">new</span> Thread(c);</span><br><span class="line"></span><br><span class="line">        ta.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>); <span class="comment">// 确保按照A、B、C顺序执行</span></span><br><span class="line">        tb.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        tc.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><b>代码流程说明</b><br>A线程启动，依次取得c、a锁，打印A，执行notify()唤醒任意一个a对象等待池中的线程，<font color="pink">待synchronized(self){}块执行完后</font>释放a锁，执行wait()，将A线程放入c对象相关的等待池中等待<font color="pink">被唤醒</font>，<font color="pink">同时</font>释放c锁； 1秒后，B线程启动，依次取得a、b锁，打印B，执行notify()唤醒任意一个b对象等待池中的线程，待synchronized(self){}块执行完后释放b锁，执行wait()，将B线程放入a对象相关的等待池中等待被唤醒，同时释放a锁；1秒后，C线程启动，依次取得b、c锁，打印C，执行notify()唤醒任意一个c对象等待池中的线程(此时A线程被唤醒)，待synchronized(self){}块执行完后释放c锁，执行wait()，将C线程放入b对象相关的等待池中等待被唤醒，同时释放b锁。</p><p>至此，完成一次ABC的打印。继续执行，从A线程开始，执行各自线程中的下一次循环。</p><p><b><i>特别说明</i></b><br>Java源码中wait()默认调用的是wait(0)，表明线程无限等待，只能被其他线程唤醒。</p><blockquote><p>参考<br><a href="https://blog.csdn.net/u010002184/article/details/82912225" target="_blank" rel="noopener">https://blog.csdn.net/u010002184/article/details/82912225</a><br><a href="https://blog.csdn.net/hj1997a/article/details/84284973" target="_blank" rel="noopener">https://blog.csdn.net/hj1997a/article/details/84284973</a></p></blockquote></div><footer class="article-footer"><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVA/">JAVA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/多线程/">多线程</a></li></ul><div style="text-align:center;color:#ccc;font-size:14px;margin-top:10px"> ------------- 本文结束&nbsp;<i class="fe fe-smile"></i>&nbsp;感谢您的阅读 -------------</div></footer></div><nav class="article-nav"> <a href="/2019/11/08/Java多线程-一-基础篇/" class="article-nav-link"><strong class="article-nav-caption">后一篇</strong><div class="article-nav-title">Java多线程(一)-基础篇</div></a></nav><div class="comment_headling" style="margin-top:5rem"><font size="5"><i class="fe fe-comments"></i> 评论</font></div><div class="comment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/js/Valine.min.js"></script><script type="text/javascript">GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)}),guest_info=0==guest_info.length?GUEST_INFO:guest_info,new Valine({av:AV,el:".comment",app_id:"fq4O7Xaf1cYDbADGellNEn6V-gzGzoHsz",app_key:"a626rNIHkVVk8tGBBCfaQjb9",placeholder:"记得留下你的昵称和邮箱...可以快速收到回复ヾﾉ≧∀≦)o",meta:guest_info,notify:!0,verify:!1,avatar:"monsterid",recordIP:!0,visitor:!1,lang:"zh-cn"})</script></article></section><footer class="footer"><div class="outer"><ul class="list-inline"><li>已分享 49 篇博文，累计 <span class="post-count">55.1k</span> 字</li><ul class="list-inline"><li><i class="fe fe-smile-alt"></i>&nbsp;访客数&emsp;<span id="busuanzi_value_site_uv"></span></li><li><i class="fe fe-bookmark"></i>&nbsp;文章访问量&emsp;<span id="busuanzi_value_page_pv"></span></li></ul></ul><ul class="list-inline"><li><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span></li><script>var now=new Date;function createtime(){var n=new Date("07/28/2019 10:02:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="已等候你 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script><ul class="list-inline"><li>&copy; 2019-2019 松林羊</li><li>Theme <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li></ul></ul></div></footer></main><aside class="sidebar sidebar-specter"> <button class="navbar-toggle"></button><nav class="navbar"><div class="logo"> <a href="/"><img id="andus-head-img" src="/images/head-nav.png" alt="松林羊"></a></div><ul class="nav nav-main"><li class="nav-item"> <a class="nav-item-link" href="/" target="_self">主页</a></li><li class="nav-item"> <a class="nav-item-link" href="/archives" target="_self">归档</a></li><li class="nav-item"> <a class="nav-item-link" href="/categories" target="_self">分类</a></li><li class="nav-item"> <a class="nav-item-link" href="/tags" target="_self">标签</a></li><li class="nav-item"> <a class="nav-item-link" href="/links" target="_self">友链</a></li><li class="nav-item"> <a class="nav-item-link">综合</a><ul class="nav nav-main nav2"><li class="nav-item li2"> <a class="nav-item-link-child" href="/resource" target="_self">资 源</a></li><li class="nav-item li2"> <a class="nav-item-link-child" href="/site" target="_self">网 站</a></li></ul></li><li class="nav-item"> <a class="nav-item-link">关于</a><ul class="nav nav-main nav2"><li class="nav-item li2"> <a class="nav-item-link-child" href="/me" target="_self">博 主</a></li><li class="nav-item li2"> <a class="nav-item-link-child" href="http://stars.andus.top/" target="_blank">记 录</a></li><li class="nav-item li2"> <a class="nav-item-link-child" href="/plan" target="_self">计 划</a></li></ul></li><li class="nav-item"> <a class="nav-item-link" href="http://resume.andus.top/" target="_blank">简 历</a></li><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="fe fe-search"></i> 搜索</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><div class="totop" id="totop"><i class="fe fe-rocket"></i></div></li><li class="nav-item"></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"> <input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/jquery.justifiedGallery.min.js"></script><script src="/js/lazyload.min.js"></script><script src="/js/busuanzi-2.3.pure.min.js"></script><script src="/fancybox/jquery.fancybox.min.js"></script><script src="/js/tocbot.min.js"></script><script>900<=document.body.clientWidth&&tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script src="/js/ocean.js"></script><script src="/js/andus.js"></script><script src="/js/love.js"></script><script>$("img:not(#andus-head-img)").each(function(){$(this).wrap('<a class="fancybox" data-fancybox="gallery" href="'+$(this).prop("src")+'"></a>')})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({model:{scale:1,hHeadPos:.5,vHeadPos:.618,jsonPath:"/live2dw/assets/haruto.model.json"},display:{superSample:2,width:150,height:300,position:"left",hOffset:0,vOffset:-20},mobile:{show:!1},react:{opacityDefault:.5,opacityOnHover:.2},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body>